<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="animal_safari.css"/>

    <script type = "text/javascript">

        var ws = new WebSocket("ws://192.168.1.32:1337/echo");
        ws.onopen = function() {
            ws.send("HELLO");
        };
        ws.onmessage = function(event) {
            let message = event.data;
            let obj = JSON.parse(message);
            console.log('ws.onmessage event: JSON', obj);

            if(obj.type == "CHOOSE_PLAYER") {

                obj.payload.forEach( (p, idx) => {
                    if(p.id !== false) {
                        const selector = '#player-choice-' + p.id;
                        let element = document.querySelector(selector);
                        element.removeEventListener('click', choose_colour);
                        console.log("Element is currently allocated.", element);
                    }
                });
            }
            if(obj.type == "PLAYER_CONFIRMED") {

                let p = obj.payload;

                const selector = '#player-choice-' + p.id;
                let element = document.querySelector(selector);

                element.style.border = '5px solid black';
                console.log("My element is", element);

                document.querySelectorAll('#player-colour-chooser > div').forEach(
                    e => e.removeEventListener('click', choose_colour)
                );
            }
            if(obj.type == "SHOW_DICE") {

                const dice = obj.payload;
                const die1 = dice.die1 == 6 ? 'B' : dice.die1;
                const die2 = dice.die2 == 6 ? 'B' : dice.die2;

                document.querySelector('#die1').innerText = die1;
                document.querySelector('#die2').innerText = die2;
                document.querySelector('#player-move-options').innerText = 'Move Options: ' + dice.moveOptions;
            }
        };
        ws.onclose = function() { 

            // WebSocket has been closed.
            console.log("Connection was closed..."); 
        };

        function rollDice() {

            ws.send("ROLL_DICE");
        }

    </script>
            
</head>
            
<body>
    <div id="player-dice-panel">
        <div id="player-dice">
            <div id="die1" class="die"></div>
            <div id="die2" class="die"></div>
        </div>
        <div id="player-move-options">
        </div>
        <div id="dice-roll-button">
            <a href = "javascript:rollDice()">Roll Dice</a>
        </div>
    </div>

    <div>
        <h4>Colour Selector</h4>
        <div id="player-colour-chooser">
            <div id="player-choice-red"    class="player-red">Red</div>
            <div id="player-choice-green"  class="player-green">Green</div>
            <div id="player-choice-blue"   class="player-blue">Blue</div>
            <div id="player-choice-yellow" class="player-yellow">Yellow</div>
        </div>
    </div>

    <div id="board">
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
        <div>X</div>
    </div>

</body>


<script type = "text/javascript">

    function choose_colour(event) {
        console.log(event);
        const choice = event.target.id;
        const colour = choice.substr(14);
        console.log('choose_colour() invoked with', colour);
        ws.send('CHOOSE: ' + colour);
    }

    document.querySelectorAll("#player-colour-chooser > div")
        .forEach( e => e.addEventListener('click', choose_colour) );

</script>

</html>

